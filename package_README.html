

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Spdylay - SPDY C Library &mdash; Spdylay 1.4.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Spdylay 1.4.0 documentation" href="index.html"/>
        <link rel="next" title="API Reference" href="apiref.html"/>
        <link rel="prev" title="Spdylay - SPDY C Library" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Spdylay</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Spdylay - SPDY C Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#development-status">Development Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-from-git">Build from git</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-documentation">Building documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-android-binary">Building Android binary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spdy-client-and-server-programs">SPDY Client and Server Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-spdylay-python-wrapper">Python-Spdylay - Python Wrapper</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apiref.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apiref.html#includes">Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="apiref.html#remarks">Remarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="apiref.html#macros">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="apiref.html#enums">Enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="apiref.html#types-structs-unions-and-typedefs">Types (structs, unions and typedefs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="apiref.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python.html">Python-spdylay - Spdylay Python Extension Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python.html#build">Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#session-objects">Session Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#helper-functions">Helper Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#data-provider-objects">Data Provider Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#control-frame-objects">Control Frame Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#exceptions">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#read-callback-flags">Read Callback Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#error-codes">Error Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#frame-types">Frame Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#control-frame-flags">Control Frame Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#stream-status-codes">Stream Status Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#goaway-status-codes">GOAWAY Status Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#settings-frame-flags">SETTINGS Frame Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#settings-ids">SETTINGS IDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#settings-id-flags">SETTINGS ID Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#simple-spdy-client">Simple SPDY Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#simple-spdy-server">Simple SPDY Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="android-spdy-proxy.html">SPDY Proxy with Firefox for Android</a><ul>
<li class="toctree-l2"><a class="reference internal" href="android-spdy-proxy.html#setting-up-spdy-proxy">Setting up SPDY Proxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="android-spdy-proxy.html#building-spdylay-library-and-shrpx">Building spdylay library and shrpx</a></li>
<li class="toctree-l2"><a class="reference internal" href="android-spdy-proxy.html#setup-shrpx-on-android-device">Setup shrpx on Android device</a></li>
<li class="toctree-l2"><a class="reference internal" href="android-spdy-proxy.html#setup-firefox-to-use-spdy-proxy">Setup Firefox to use SPDY proxy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/tatsuhiro-t/spdylay/releases">Download</a></li>
<li class="toctree-l1"><a class="reference external" href="http://sourceforge.net/projects/spdylay/files/">Old download</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/tatsuhiro-t/spdylay">Source</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/tatsuhiro-t/spdylay/issues">Issues</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Spdylay</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Spdylay - SPDY C Library</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/package_README.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="spdylay-spdy-c-library">
<h1>Spdylay - SPDY C Library<a class="headerlink" href="#spdylay-spdy-c-library" title="Permalink to this headline">¶</a></h1>
<p>This is an experimental implementation of Google&#8217;s SPDY protocol in C.</p>
<p>This library provides SPDY version 2, 3 and 3.1 framing layer
implementation.  It does not perform any I/O operations.  When the
library needs them, it calls the callback functions provided by the
application. It also does not include any event polling mechanism, so
the application can freely choose the way of handling events. This
library code does not depend on any particular SSL library (except for
example programs which depend on OpenSSL 1.0.1 or later).</p>
<p>This project also develops SPDY client, server and proxy on top of
Spdylay library. See <a class="reference internal" href="#spdy-client-and-server-programs">SPDY Client and Server Programs</a> section.</p>
<div class="section" id="development-status">
<h2>Development Status<a class="headerlink" href="#development-status" title="Permalink to this headline">¶</a></h2>
<p>Most of the SPDY/2, SPDY/3 and SPDY/3.1 functionality has been
implemented.  In both versions, the direct support of server-push has
not been available yet.  The application can achieve server-push using
primitive APIs though.</p>
<p>As described below, we can create SPDY client and server with the
current Spdylay API.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The following packages are needed to build the library:</p>
<ul class="simple">
<li>pkg-config &gt;= 0.20</li>
<li>zlib &gt;= 1.2.3</li>
</ul>
<p>To build and run the unit test programs, the following packages are
needed:</p>
<ul class="simple">
<li>cunit &gt;= 2.1</li>
</ul>
<p>To build and run the example programs, the following packages are
needed:</p>
<ul class="simple">
<li>OpenSSL &gt;= 1.0.1</li>
</ul>
<p>To enable <code class="docutils literal"><span class="pre">-a</span></code> option (getting linked assets from the downloaded
resource) in <code class="docutils literal"><span class="pre">spdycat</span></code> (one of the example program), the following
packages are needed:</p>
<ul class="simple">
<li>libxml2 &gt;= 2.7.7</li>
</ul>
<p>To build SPDY/HTTPS to HTTP reverse proxy <code class="docutils literal"><span class="pre">shrpx</span></code> (one of the
example program), the following packages are needed:</p>
<ul class="simple">
<li>libevent-openssl &gt;= 2.0.8</li>
</ul>
<p>If you are using Ubuntu 12.04, you need the following packages
installed:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>$ apt-get install autoconf automake autotools-dev libtool pkg-config zlib1g-dev libcunit1-dev libssl-dev libxml2-dev libevent-dev
</pre></div>
</div>
</div>
<div class="section" id="build-from-git">
<h2>Build from git<a class="headerlink" href="#build-from-git" title="Permalink to this headline">¶</a></h2>
<p>Building from git is easy, but please be sure that at least autoconf 2.68 is
used:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>$ autoreconf -i
$ automake
$ autoconf
$ ./configure
$ make
</pre></div>
</div>
</div>
<div class="section" id="building-documentation">
<h2>Building documentation<a class="headerlink" href="#building-documentation" title="Permalink to this headline">¶</a></h2>
<p>To build documentation, run:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>$ make html
</pre></div>
</div>
<p>The documents will be generated under <code class="docutils literal"><span class="pre">doc/manual/html/</span></code>.</p>
<p>The generated documents will not be installed with <code class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></code>.</p>
</div>
<div class="section" id="building-android-binary">
<h2>Building Android binary<a class="headerlink" href="#building-android-binary" title="Permalink to this headline">¶</a></h2>
<p>In this section, we briefly describe how to build Android binary using
<a class="reference external" href="http://developer.android.com/tools/sdk/ndk/index.html">Android NDK</a>
cross-compiler on Debian Linux.</p>
<p>We offer <code class="docutils literal"><span class="pre">android-config</span></code> and <code class="docutils literal"><span class="pre">android-make</span></code> scripts to make the
build easier. To make these script work, NDK toolchain must be
installed in the following way. First, let introduce <code class="docutils literal"><span class="pre">ANDROID_HOME</span></code>
environment variable. We need to install toolchain under
<code class="docutils literal"><span class="pre">$ANDROID_HOME/toolchain</span></code>. An user can freely choose the path for
<code class="docutils literal"><span class="pre">ANDROID_HOME</span></code>.  For example, to install toolchain under
<code class="docutils literal"><span class="pre">$ANDROID_HOME/toolchain</span></code>, do this in the the directory where NDK is
unpacked:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>$ build/tools/make-standalone-toolchain.sh --platform=android-9 --install-dir=$ANDROID_HOME/toolchain
</pre></div>
</div>
<p>The platform level is not important here because we don&#8217;t use Android
specific C/C++ API.</p>
<p>The dependent libraries, such as OpenSSL and libevent should be built
with the toolchain and installed under <code class="docutils literal"><span class="pre">$ANDROID_HOME/usr/local</span></code>.
We recommend to build these libraries as static library to make the
deployment easier. libxml2 support is currently disabled.</p>
<p>We use zlib which comes with Android NDK, so we don&#8217;t have to build it
by ourselves.</p>
<p>Before running <code class="docutils literal"><span class="pre">android-config</span></code> and <code class="docutils literal"><span class="pre">android-make</span></code>,
<code class="docutils literal"><span class="pre">ANDOIRD_HOME</span></code> environment variable must be set to point to the
correct path.</p>
<p>After <code class="docutils literal"><span class="pre">android-config</span></code>, run <code class="docutils literal"><span class="pre">android-make</span></code> to compile sources.
<code class="docutils literal"><span class="pre">android-make</span></code> is just include path to cross compiler in <code class="docutils literal"><span class="pre">PATH</span></code>
and run make. So if you include path to corss compiler by yourself,
you can just run make to build spdylay and tools as usual.</p>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>The public API reference is available on online. Visit
<a class="reference external" href="http://tatsuhiro-t.github.io/spdylay/">http://tatsuhiro-t.github.io/spdylay/</a>.  All public APIs are in
<em>spdylay/spdylay.h</em>. All public API functions as well as the callback
function typedefs are documented.</p>
</div>
<div class="section" id="spdy-client-and-server-programs">
<h2>SPDY Client and Server Programs<a class="headerlink" href="#spdy-client-and-server-programs" title="Permalink to this headline">¶</a></h2>
<p>The <em>src</em> directory contains SPDY client and server implementations
using Spdylay library. These programs are intended to make sure that
Spdylay API is acutally usable for real implementation and also for
debugging purposes. Please note that OpenSSL with <a class="reference external" href="http://technotes.googlecode.com/git/nextprotoneg.html">NPN</a> support is
required in order to build and run these programs.  At the time of
this writing, the OpenSSL 1.0.1 supports NPN.</p>
<div class="section" id="spdycat-spdy-client">
<h3>Spdycat - SPDY client<a class="headerlink" href="#spdycat-spdy-client" title="Permalink to this headline">¶</a></h3>
<p>The SPDY client is called <code class="docutils literal"><span class="pre">spdycat</span></code>. It is a dead simple downloader
like wget/curl. It connects to SPDY server and gets resources given in
the command-line:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>$ src/spdycat -h
Usage: spdycat [-Oansv23] [-t &lt;SECONDS&gt;] [-w &lt;WINDOW_BITS&gt;] [--cert=&lt;CERT&gt;]
               [--key=&lt;KEY&gt;] [--no-tls] [-d &lt;FILE&gt;] [-m &lt;N&gt;] [-p &lt;PROXY_HOST&gt;]
               [-P &lt;PROXY_PORT&gt;] &lt;URI&gt;...

OPTIONS:
    -v, --verbose      Print debug information such as reception/
                       transmission of frames and name/value pairs.
    -n, --null-out     Discard downloaded data.
    -O, --remote-name  Save download data in the current directory.
                       The filename is dereived from URI. If URI
                       ends with &#39;/&#39;, &#39;index.html&#39; is used as a
                       filename. Not implemented yet.
    -2, --spdy2        Only use SPDY/2.
    -3, --spdy3        Only use SPDY/3.
    --spdy3-1          Only use SPDY/3.1.
    -t, --timeout=&lt;N&gt;  Timeout each request after &lt;N&gt; seconds.
    -w, --window-bits=&lt;N&gt;
                       Sets the initial window size to 2**&lt;N&gt;.
    -a, --get-assets   Download assets such as stylesheets, images
                       and script files linked from the downloaded
                       resource. Only links whose origins are the
                       same with the linking resource will be
                       downloaded.
    -s, --stat         Print statistics.
    -H, --header       Add a header to the requests.
    --cert=&lt;CERT&gt;      Use the specified client certificate file.
                       The file must be in PEM format.
    --key=&lt;KEY&gt;        Use the client private key file. The file
                       must be in PEM format.
    --no-tls           Disable SSL/TLS. Use -2, -3 or --spdy3-1 to
                       specify SPDY protocol version to use.
    -d, --data=&lt;FILE&gt;  Post FILE to server. If - is given, data
                       will be read from stdin.
    -m, --multiply=&lt;N&gt; Request each URI &lt;N&gt; times. By default, same
                       URI is not requested twice. This option
                       disables it too.
    -p, --proxy=&lt;HOST&gt; Use this host as a SPDY proxy
    -P, --proxy-port=&lt;PORT&gt;
                       Use this as the port of the SPDY proxy if
                       one is set
    --color            Force colored log output.

$ src/spdycat -nv https://www.google.com/
[  0.021] NPN select next protocol: the remote server offers:
          * spdy/4a4
          * spdy/3.1
          * spdy/3
          * http/1.1
          NPN selected the protocol: spdy/3.1
[  0.029] Handshake complete
[  0.029] recv SETTINGS frame &lt;version=3, flags=0, length=20&gt;
          (niv=2)
          [4(1):100]
          [7(0):1048576]
[  0.029] recv WINDOW_UPDATE frame &lt;version=3, flags=0, length=8&gt;
          (stream_id=0, delta_window_size=983040)
[  0.029] send SYN_STREAM frame &lt;version=3, flags=1, length=221&gt;
          (stream_id=1, assoc_stream_id=0, pri=3)
          :host: www.google.com
          :method: GET
          :path: /
          :scheme: https
          :version: HTTP/1.1
          accept: */*
          accept-encoding: gzip, deflate
          user-agent: spdylay/1.2.0-DEV
[  0.080] recv SYN_REPLY frame &lt;version=3, flags=0, length=619&gt;
          (stream_id=1)
          :status: 302 Found
          :version: HTTP/1.1
          alternate-protocol: 443:quic
          cache-control: private
          content-length: 262
          content-type: text/html; charset=UTF-8
          date: Tue, 19 Nov 2013 13:47:18 GMT
          location: https://www.google.co.jp/
          server: gws
          x-frame-options: SAMEORIGIN
          x-xss-protection: 1; mode=block
[  0.080] recv DATA frame (stream_id=1, flags=1, length=262)
[  0.080] send GOAWAY frame &lt;version=3, flags=0, length=8&gt;
          (last_good_stream_id=0)
</pre></div>
</div>
</div>
<div class="section" id="spdyd-spdy-server">
<h3>Spdyd - SPDY server<a class="headerlink" href="#spdyd-spdy-server" title="Permalink to this headline">¶</a></h3>
<p>SPDY server is called <code class="docutils literal"><span class="pre">spdyd</span></code> and serves static files. It is single
threaded and multiplexes connections using non-blocking socket. The
static files are read using blocking I/O system call, <code class="docutils literal"><span class="pre">read(2)</span></code>. It
speaks SPDY/2 and SPDY/3:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>$ src/spdyd --htdocs=/your/htdocs/ -v 3000 server.key server.crt
IPv4: listen on port 3000
IPv6: listen on port 3000
The negotiated next protocol: spdy/3.1
[id=1] [  1.296] send SETTINGS frame &lt;version=3, flags=0, length=12&gt;
          (niv=1)
          [4(0):100]
[id=1] [  1.297] recv SYN_STREAM frame &lt;version=3, flags=1, length=228&gt;
          (stream_id=1, assoc_stream_id=0, pri=3)
          :host: localhost:3000
          :method: GET
          :path: /README
          :scheme: https
          :version: HTTP/1.1
          accept: */*
          accept-encoding: gzip, deflate
          user-agent: spdylay/1.2.0-DEV
[id=1] [  1.297] send SYN_REPLY frame &lt;version=3, flags=0, length=116&gt;
          (stream_id=1)
          :status: 200 OK
          :version: HTTP/1.1
          cache-control: max-age=3600
          content-length: 66
          date: Tue, 19 Nov 2013 14:35:24 GMT
          last-modified: Tue, 17 Jan 2012 15:39:01 GMT
          server: spdyd spdylay/1.2.0-DEV
[id=1] [  1.297] send DATA frame (stream_id=1, flags=0, length=66)
[id=1] [  1.297] send DATA frame (stream_id=1, flags=1, length=0)
[id=1] [  1.297] stream_id=1 closed
[id=1] [  1.297] recv GOAWAY frame &lt;version=3, flags=0, length=8&gt;
          (last_good_stream_id=0)
[id=1] [  1.297] closed
</pre></div>
</div>
<p>Currently, <code class="docutils literal"><span class="pre">spdyd</span></code> needs <code class="docutils literal"><span class="pre">epoll</span></code> or <code class="docutils literal"><span class="pre">kqueue</span></code>.</p>
</div>
<div class="section" id="shrpx-a-reverse-proxy-for-spdy-https">
<h3>Shrpx - A reverse proxy for SPDY/HTTPS<a class="headerlink" href="#shrpx-a-reverse-proxy-for-spdy-https" title="Permalink to this headline">¶</a></h3>
<p>For shrpx users who uses shrpx as SPDY proxy: Please consider
migrating to nghttpx developed at <a class="reference external" href="https://nghttp2.org">nghttp2 project</a>.  nghttpx supports SPDY proxy too.</p>
<p>The <code class="docutils literal"><span class="pre">shrpx</span></code> is a multi-threaded reverse proxy for SPDY/HTTPS.  It
converts SPDY/HTTPS traffic to plain HTTP.  It is initially developed
as a reverse proxy, but now it has other operation modes such as a
frontend forward proxy.  For example, with <code class="docutils literal"><span class="pre">--spdy-proxy</span></code> (<code class="docutils literal"><span class="pre">-s</span></code> in
shorthand) option, it can be used as secure SPDY proxy with a proxy
(e.g., Squid) in the backend.  With <code class="docutils literal"><span class="pre">--cliet-proxy</span></code> (<code class="docutils literal"><span class="pre">-p</span></code>) option,
it acts like an ordinaly forward proxy but expects secure SPDY proxy
in the backend. Thus it becomes an adapter to secure SPDY proxy for
clients which does not support secure SPDY proxy. The another notable
operation mode is <code class="docutils literal"><span class="pre">--spdy-relay</span></code>, which just relays SPDY/HTTPS
traffic to the backend in SPDY. The following table summarizes the
operation modes.</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="21%" />
<col width="15%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mode option</th>
<th class="head">Frontend</th>
<th class="head">Backend</th>
<th class="head">Note</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>default</td>
<td>SPDY/HTTPS</td>
<td>HTTP</td>
<td>Reverse proxy</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">--spdy</span></code></td>
<td>SPDY/HTTPS</td>
<td>HTTP</td>
<td>SPDY proxy</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">--spdy-relay</span></code></td>
<td>SPDY/HTTPS</td>
<td>SPDY</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">--client</span></code></td>
<td>HTTP</td>
<td>SPDY</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">--client-proxy</span></code></td>
<td>HTTP</td>
<td>SPDY</td>
<td>Forward proxy</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">shrpx</span></code> supports configuration file. See <code class="docutils literal"><span class="pre">--conf</span></code> option and
sample configuration file <code class="docutils literal"><span class="pre">shrpx.conf.sample</span></code>.</p>
<p>We briefly describe the architecture of <code class="docutils literal"><span class="pre">shrpx</span></code> here.  It has a
dedicated thread which listens on server sockets.  When it accepted
the incoming connection, it passes the file descriptor of the incoming
connection to one of the worker thread.  Each worker thread has its
own event loop and can handle many connections using non-blocking I/O.
The number of worker thread can be specified using the command-line
option. The <a class="reference external" href="http://libevent.org/">libevent</a> is used to handle
low-level network I/O.</p>
<p>Here is the command-line options:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>$ src/shrpx -h
Usage: shrpx [-Dh] [-s|--client|-p] [-b &lt;HOST,PORT&gt;]
             [-f &lt;HOST,PORT&gt;] [-n &lt;CORES&gt;] [-c &lt;NUM&gt;] [-L &lt;LEVEL&gt;]
             [OPTIONS...] [&lt;PRIVATE_KEY&gt; &lt;CERT&gt;]

A reverse proxy for SPDY/HTTPS.

Positional arguments:
    &lt;PRIVATE_KEY&gt;      Set path to server&#39;s private key. Required
                       unless either -p or --client is specified.
    &lt;CERT&gt;             Set path to server&#39;s certificate. Required
                       unless either -p or --client is specified.

OPTIONS:

  Connections:
    -b, --backend=&lt;HOST,PORT&gt;
                       Set backend host and port.
                       Default: &#39;127.0.0.1,80&#39;
    -f, --frontend=&lt;HOST,PORT&gt;
                       Set frontend host and port.
                       Default: &#39;0.0.0.0,3000&#39;
    --backlog=&lt;NUM&gt;    Set listen backlog size.
                       Default: 256
    --backend-ipv4     Resolve backend hostname to IPv4 address
                       only.
    --backend-ipv6     Resolve backend hostname to IPv6 address
                       only.

  Performance:
    -n, --workers=&lt;CORES&gt;
                       Set the number of worker threads.
                       Default: 1
    --read-rate=&lt;RATE&gt; Set maximum average read rate on frontend
                       connection. Setting 0 to this option means
                       read rate is unlimited.
                       Default: 1048576
    --read-burst=&lt;SIZE&gt;
                       Set maximum read burst size on frontend
                       connection. Setting 0 to this option means
                       read burst size is unlimited.
                       Default: 4194304
    --write-rate=&lt;RATE&gt;
                       Set maximum average write rate on frontend
                       connection. Setting 0 to this option means
                       write rate is unlimited.
                       Default: 0
    --write-burst=&lt;SIZE&gt;
                       Set maximum write burst size on frontend
                       connection. Setting 0 to this option means
                       write burst size is unlimited.
                       Default: 0

  Timeout:
    --frontend-spdy-read-timeout=&lt;SEC&gt;
                       Specify read timeout for SPDY frontend
                       connection. Default: 180
    --frontend-read-timeout=&lt;SEC&gt;
                       Specify read timeout for non-SPDY frontend
                       connection. Default: 180
    --frontend-write-timeout=&lt;SEC&gt;
                       Specify write timeout for both SPDY and
                       non-SPDY frontends.
                       connection. Default: 60
    --backend-read-timeout=&lt;SEC&gt;
                       Specify read timeout for backend connection.
                       Default: 900
    --backend-write-timeout=&lt;SEC&gt;
                       Specify write timeout for backend
                       connection. Default: 60
    --backend-keep-alive-timeout=&lt;SEC&gt;
                       Specify keep-alive timeout for backend
                       connection. Default: 60
    --backend-http-proxy-uri=&lt;URI&gt;
                       Specify proxy URI in the form
                       http://[&lt;USER&gt;:&lt;PASS&gt;@]&lt;PROXY&gt;:&lt;PORT&gt;. If
                       a proxy requires authentication, specify
                       &lt;USER&gt; and &lt;PASS&gt;. Note that they must be
                       properly percent-encoded. This proxy is used
                       when the backend connection is SPDY. First,
                       make a CONNECT request to the proxy and
                       it connects to the backend on behalf of
                       shrpx. This forms tunnel. After that, shrpx
                       performs SSL/TLS handshake with the
                       downstream through the tunnel. The timeouts
                       when connecting and making CONNECT request
                       can be specified by --backend-read-timeout
                       and --backend-write-timeout options.

  SSL/TLS:
    --ciphers=&lt;SUITE&gt;  Set allowed cipher list. The format of the
                       string is described in OpenSSL ciphers(1).
                       If this option is used, --honor-cipher-order
                       is implicitly enabled.
    --honor-cipher-order
                       Honor server cipher order, giving the
                       ability to mitigate BEAST attacks.
    -k, --insecure     When used with -p or --client, don&#39;t verify
                       backend server&#39;s certificate.
    --cacert=&lt;PATH&gt;    When used with -p or --client, set path to
                       trusted CA certificate file.
                       The file must be in PEM format. It can
                       contain multiple certificates. If the
                       linked OpenSSL is configured to load system
                       wide certificates, they are loaded
                       at startup regardless of this option.
    --private-key-passwd-file=&lt;FILEPATH&gt;
                       Path to file that contains password for the
                       server&#39;s private key. If none is given and
                       the private key is password protected it&#39;ll
                       be requested interactively.
    --subcert=&lt;KEYPATH&gt;:&lt;CERTPATH&gt;
                       Specify additional certificate and private
                       key file. Shrpx will choose certificates
                       based on the hostname indicated by client
                       using TLS SNI extension. This option can be
                       used multiple times.
    --backend-tls-sni-field=&lt;HOST&gt;
                       Explicitly set the content of the TLS SNI
                       extension.  This will default to the backend
                       HOST name.
    --dh-param-file=&lt;PATH&gt;
                       Path to file that contains DH parameters in
                       PEM format. Without this option, DHE cipher
                       suites are not available.
    --verify-client    Require and verify client certificate.
    --verify-client-cacert=&lt;PATH&gt;
                       Path to file that contains CA certificates
                       to verify client certificate.
                       The file must be in PEM format. It can
                       contain multiple certificates.
    --client-private-key-file=&lt;PATH&gt;
                       Path to file that contains client private
                       key used in backend client authentication.
    --client-cert-file=&lt;PATH&gt;
                       Path to file that contains client
                       certificate used in backend client
                       authentication.
    --tls-proto-list=&lt;LIST&gt;
                       Comma delimited list of SSL/TLS protocol to
                       be enabled.
                       The following protocols are available:
                       TLSv1.2, TLSv1.1, TLSv1.0, SSLv3
                       The name matching is done in case-insensitive
                       manner.
                       The parameter must be delimited by a single
                       comma only and any white spaces are treated
                       as a part of protocol string.
                       Default: TLSv1.2,TLSv1.1,TLSv1.0

  SPDY:
    -c, --spdy-max-concurrent-streams=&lt;NUM&gt;
                       Set the maximum number of the concurrent
                       streams in one SPDY session.
                       Default: 100
    --frontend-spdy-window-bits=&lt;N&gt;
                       Sets the per-stream initial window size of
                       SPDY frontend connection to 2**&lt;N&gt;.
                       Default: 16
    --frontend-spdy-connection-window-bits=&lt;N&gt;
                       Sets the per-connection window size of SPDY
                       frontend connection to 2**&lt;N&gt;.
                       Default: 16
    --frontend-spdy-no-tls
                       Disable SSL/TLS on frontend SPDY
                       connections. SPDY protocol must be specified
                       using --frontend-spdy-proto. This option
                       also disables frontend HTTP/1.1.
    --frontend-spdy-proto
                       Specify SPDY protocol used in frontend
                       connection if --frontend-spdy-no-tls is
                       used. Default: spdy/3.1
    --backend-spdy-window-bits=&lt;N&gt;
                       Sets the per-stream initial window size of
                       SPDY backend connection to 2**&lt;N&gt;.
                       Default: 16
    --backend-spdy-connection-window-bits=&lt;N&gt;
                       Sets the per-connection window size of SPDY
                       backend connection to 2**&lt;N&gt;.
                       Default: 16
    --backend-spdy-no-tls
                       Disable SSL/TLS on backend SPDY connections.
                       SPDY protocol must be specified using
                       --backend-spdy-proto
    --backend-spdy-proto
                       Specify SPDY protocol used in backend
                       connection if --backend-spdy-no-tls is used.
                       Default: spdy/3.1

  Mode:
    -s, --spdy-proxy   Enable secure SPDY proxy mode.
    --spdy-bridge      Communicate with the backend in SPDY. Thus
                       the incoming SPDY/HTTPS connections are
                       converted to SPDY connection and relayed to
                       the backend. See --backend-http-proxy-uri
                       option if you are behind the proxy and want
                       to connect to the outside SPDY proxy.
    --client           Instead of accepting SPDY/HTTPS connection,
                       accept HTTP connection and communicate with
                       backend server in SPDY. To use shrpx as
                       a forward proxy, use -p option instead.
    -p, --client-proxy Like --client option, but it also requires
                       the request path from frontend must be
                       an absolute URI, suitable for use as a
                       forward proxy.

  Logging:
    -L, --log-level=&lt;LEVEL&gt;
                       Set the severity level of log output.
                       INFO, WARNING, ERROR and FATAL.
                       Default: WARNING
    --accesslog        Print simple accesslog to stderr.
    --syslog           Send log messages to syslog.
    --syslog-facility=&lt;FACILITY&gt;
                       Set syslog facility.
                       Default: daemon

  Misc:
    --add-x-forwarded-for
                       Append X-Forwarded-For header field to the
                       downstream request.
    --no-via           Don&#39;t append to Via header field. If Via
                       header field is received, it is left
                       unaltered.
    -D, --daemon       Run in a background. If -D is used, the
                       current working directory is changed to &#39;/&#39;.
    --pid-file=&lt;PATH&gt;  Set path to save PID of this program.
    --user=&lt;USER&gt;      Run this program as USER. This option is
                       intended to be used to drop root privileges.
    --conf=&lt;PATH&gt;      Load configuration from PATH.
                       Default: /etc/shrpx/shrpx.conf
    -v, --version      Print version and exit.
    -h, --help         Print this help and exit.
</pre></div>
</div>
<p>For those of you who are curious, <code class="docutils literal"><span class="pre">shrpx</span></code> is an abbreviation of
&#8220;Spdy/https to Http Reverse ProXy&#8221;.</p>
<p>Without any of <code class="docutils literal"><span class="pre">-s</span></code>, <code class="docutils literal"><span class="pre">--spdy-bridge</span></code>, <code class="docutils literal"><span class="pre">-p</span></code> and <code class="docutils literal"><span class="pre">--client</span></code>
options, <code class="docutils literal"><span class="pre">shrpx</span></code> works as reverse proxy to the backend server:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">Client</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">SPDY</span><span class="p">,</span> <span class="n">HTTPS</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Shrpx</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">HTTP</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Web</span> <span class="n">Server</span>
                        <span class="p">[</span><span class="n">reverse</span> <span class="n">proxy</span><span class="p">]</span>
</pre></div>
</div>
<p>With <code class="docutils literal"><span class="pre">-s</span></code> option, it works as secure SPDY proxy:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">Client</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">SPDY</span><span class="p">,</span> <span class="n">HTTPS</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Shrpx</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">HTTP</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Proxy</span>
                          <span class="p">[</span><span class="n">SPDY</span> <span class="n">proxy</span><span class="p">]</span>            <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span> <span class="n">Squid</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">Client</span></code> in the above is needs to be configured to use shrpx as
secure SPDY proxy.</p>
<p>At the time of this writing, Chrome is the only browser which supports
secure SPDY proxy. The one way to configure Chrome to use secure SPDY
proxy is create proxy.pac script like this:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">FindProxyForURL</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;HTTPS SERVERADDR:PORT&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">SERVERADDR</span></code> and <code class="docutils literal"><span class="pre">PORT</span></code> is the hostname/address and port of the
machine shrpx is running.  Please note that Chrome requires valid
certificate for secure SPDY proxy.</p>
<p>Then run chrome with the following arguments:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>$ google-chrome --proxy-pac-url=file:///path/to/proxy.pac --use-npn
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>At the time of this writing, Chrome 24 limits the maximum
concurrent connections to the proxy to 32. And due to the
limitation of socket pool handling in Chrome, it is quickly filled
up if SPDY proxy is used and many SPDY sessions are established. If
it reaches the limit, the new connections are simply blocked until
existing connections are timed out. (See <a class="reference external" href="https://code.google.com/p/chromium/issues/detail?id=92244">Chrome Issue 92244</a>). The
workaround is make the number of maximum connections high, say, 99,
which is the highest. To do this, you need to change so called
Policy setup.  See <a class="reference external" href="http://dev.chromium.org/administrators/policy-templates">Policy Templates</a> for
details how to change Policy setup on the platform you use.  The
Policy name we are looking for is <a class="reference external" href="http://dev.chromium.org/administrators/policy-list-3#MaxConnectionsPerProxy">MaxConnectionsPerProxy</a>
For example, if you are using Linux, follow the instruction
described in <a class="reference external" href="http://dev.chromium.org/administrators/linux-quick-start">Linux Quick Start</a> and
create <code class="docutils literal"><span class="pre">/etc/opt/chrome/policies/managed/test_policy.json</span></code> file
with the following content and restart Chrome:</p>
<div class="last highlight-c"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s">&quot;MaxConnectionsPerProxy&quot;</span> <span class="o">:</span><span class="mi">99</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>With <code class="docutils literal"><span class="pre">--spdy-bridge</span></code>, it accepts SPDY/HTTPS connections and
communicates with backend in SPDY:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">Client</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">SPDY</span><span class="p">,</span> <span class="n">HTTPS</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Shrpx</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">SPDY</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Web</span> <span class="n">or</span> <span class="n">SPDY</span> <span class="n">Proxy</span> <span class="n">etc</span>
                          <span class="p">[</span><span class="n">SPDY</span> <span class="n">bridge</span><span class="p">]</span>           <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span> <span class="n">shrpx</span> <span class="o">-</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>With <code class="docutils literal"><span class="pre">-p</span></code> option, it works as forward proxy and expects that the
backend is secure SPDY proxy:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">Client</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">HTTP</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Shrpx</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">SPDY</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Secure</span> <span class="n">SPDY</span> <span class="n">Proxy</span>
                 <span class="p">[</span><span class="n">forward</span> <span class="n">proxy</span><span class="p">]</span>         <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span> <span class="n">shrpx</span> <span class="o">-</span><span class="n">s</span> <span class="n">or</span> <span class="n">node</span><span class="o">-</span><span class="n">spdyproxy</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">Client</span></code> is needs to be configured to use shrpx as forward proxy.</p>
<p>In this configuration, clients which do not support secure SPDY proxy
can use secure SPDY proxy through <code class="docutils literal"><span class="pre">shrpx</span></code>. Putting <code class="docutils literal"><span class="pre">shrpx</span></code> in the
same box or same network with the clients, this configuration can
bring the benefits of secure SPDY proxy to those clients. Since the
maximum number of connections per server still applies in proxy
connection, the performance gain is not obvious. For example, if the
maximum number of connections per server is 6, after sending 6
requests to the proxy, client blocks further requests, which kills
performance which might be gained in SPDY connection.  For clients
which can tweak these values (e.g.,
<code class="docutils literal"><span class="pre">network.http.max-connections-per-server</span></code> in Firefox), increasing
them may improve the performance.</p>
<p>With <code class="docutils literal"><span class="pre">--client</span></code> option, it works as reverse proxy and expects that
the backend is SPDY-enabled Web server:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">Client</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">HTTP</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Shrpx</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">SPDY</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Web</span> <span class="n">Server</span>
                 <span class="p">[</span><span class="n">reverse</span> <span class="n">proxy</span><span class="p">]</span>
</pre></div>
</div>
<p>For the operation modes which talk to the backend in SPDY, the backend
connections can be tunneled though HTTP proxy. The proxy is specified
using <code class="docutils literal"><span class="pre">--backend-http-proxy-uri</span></code> option. The following figure
illustrates the example of <code class="docutils literal"><span class="pre">--spdy-bridge</span></code> and
<code class="docutils literal"><span class="pre">--backend-http-proxy-uri</span></code> option to talk to the outside SPDY proxy
through HTTP proxy:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">Client</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">SPDY</span><span class="p">,</span> <span class="n">HTTPS</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Shrpx</span> <span class="o">&lt;--</span> <span class="p">(</span><span class="n">SPDY</span><span class="p">)</span> <span class="o">--</span>
                         <span class="p">[</span><span class="n">SPDY</span> <span class="n">bridge</span><span class="p">]</span>

        <span class="o">--===================---&gt;</span> <span class="n">SPDY</span> <span class="n">Proxy</span>
          <span class="p">(</span><span class="n">HTTP</span> <span class="n">proxy</span> <span class="n">tunnel</span><span class="p">)</span>     <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.,</span> <span class="n">shrpx</span> <span class="o">-</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The <em>examples</em> directory contains a simple SPDY client implementation
in C.</p>
</div>
<div class="section" id="python-spdylay-python-wrapper">
<h2>Python-Spdylay - Python Wrapper<a class="headerlink" href="#python-spdylay-python-wrapper" title="Permalink to this headline">¶</a></h2>
<p>The library comes with Python wrapper <code class="docutils literal"><span class="pre">python-spdylay</span></code>. See
<code class="docutils literal"><span class="pre">python</span></code> directory.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="apiref.html" class="btn btn-neutral float-right" title="API Reference">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Spdylay - SPDY C Library"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012, 2014, Tatsuhiro Tsujikawa.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.4.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>